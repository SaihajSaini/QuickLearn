"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseFile = parseFile;
const content_tag_1 = require("content-tag");
const hbs_extractor_1 = require("./hbs_extractor");
const parse_script_1 = require("./parse_script");
let p = new content_tag_1.Preprocessor();
function parseFile(source, fileName, options) {
    const scriptParseFn = (0, parse_script_1.parseScript)(options, fileName);
    const transformedSource = p.process(source, { filename: fileName });
    scriptParseFn(transformedSource);
    // extract template from transformed source to then run through hbs processor
    const parseResult = p.parse(source, { filename: fileName });
    for (let parsed of parseResult) {
        (0, hbs_extractor_1.parseFile)(parsed.contents, fileName, options);
    }
}
