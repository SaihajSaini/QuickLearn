import { useUnlighthouse } from "@unlighthouse/core";
import { createApp, toNodeListener } from "h3";
import { listen } from "listhen";

//#region src/index.ts
/**
* Create a web server and web app to host the unlighthouse client and API on.
*
* Some providers, such as Nuxt, do not need this, so this can be safely tree-shaken.
*/
async function createServer() {
	const { resolvedConfig } = useUnlighthouse();
	const app = createApp();
	const server = await listen(toNodeListener(app), {
		...resolvedConfig.server,
		open: false
	});
	return {
		app,
		server
	};
}

//#endregion
export { createServer };